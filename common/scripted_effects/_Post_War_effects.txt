


# This can be used normally: TAG = { white_peace_with_ROOT = yes }
# Remember: ROOT is the country running the current event
# TAG is the country you want ROOT to completely be at peace with
# meaning it will ensure peace with all faction members and puppets on either side

white_peace_with_ROOT = {
	hidden_effect = {
		save_event_target_as = peace_country

		# first check for a faction leader to white peace with
		if = {
			limit = {
				is_in_faction = yes
				is_faction_leader = no
				faction_leader = { has_war_with = ROOT }
			}
			set_country_flag = KR_war_skip
			faction_leader = {
				white_peace = ROOT
			}
		}
		if = {
			limit = {
				ROOT = {
					is_in_faction = yes
					is_faction_leader = no
					faction_leader = { has_war_with = event_target:peace_country }
				}
			}
			set_country_flag = KR_war_skip
			ROOT = {
				faction_leader = {
					white_peace = event_target:peace_country
				}
			}
		}

		# then check for an overlord to white peace with
		if = {
			limit = {
				is_subject = yes
				overlord = { has_war_with = ROOT }
			}
			set_country_flag = KR_war_skip
			overlord = { white_peace = ROOT }
		}
		if = {
			limit = {
				ROOT = {
					is_subject = yes
					overlord = { has_war_with = event_target:peace_country }
				}
			}
			set_country_flag = KR_war_skip
			ROOT = {
				overlord = {
					white_peace = event_target:peace_country
				}
			}
		}
	}

	if = {
		limit = { has_country_flag = KR_war_skip }
		clr_country_flag = KR_war_skip
	}
	else = {
		white_peace = ROOT
	}

	hidden_effect = {
		# now double-check to ensure all faction members are peaced out
		every_enemy_country = {
			limit = {
				OR = {
					is_in_faction_with = ROOT
					is_subject_of = ROOT
					has_subject = ROOT
				}
			}
			country_event = { id = kr.political.206 hours = 2 }
		}
		ROOT = {
			every_enemy_country = {
				limit = {
					OR = {
						is_in_faction_with = event_target:peace_country
						is_subject_of = event_target:peace_country
						has_subject = event_target:peace_country
					}
				}
				country_event = { id = kr.political.205 hours = 2 }
			}
		}
	}
}

